import { DiffChange, Status, FailReason } from '../consts';
function roundDecimals(num, decimals) {
    return Number(Math.round(Number(num + 'e' + decimals)) + 'e-' + decimals);
}
export function getPercentageDiff(a, b) {
    const percent = ((a - b) / b) * 100;
    const diff = Number.isFinite(percent) ? roundDecimals(percent, 2) : percent;
    return Number.isNaN(diff) ? 0 : diff;
}
export function calcChange({ isExistsInCurrBranch, isExistsInBaseBranch, diffBytes }) {
    if (isExistsInCurrBranch && isExistsInBaseBranch) {
        // return update only if the change is greater than 10 bytes
        if (Math.abs(diffBytes) > 10) {
            return DiffChange.Update;
        }
        else {
            return DiffChange.NoChange;
        }
    }
    if (isExistsInCurrBranch) {
        return DiffChange.Add;
    }
    return DiffChange.Remove;
}
export function getStatusObject({ currBranchFile, change, diffPercent }) {
    const failReasons = [];
    if ((currBranchFile === null || currBranchFile === void 0 ? void 0 : currBranchFile.maxSize) && currBranchFile.size > currBranchFile.maxSize) {
        failReasons.push(FailReason.MaxSize);
    }
    if (change === DiffChange.Update &&
        (currBranchFile === null || currBranchFile === void 0 ? void 0 : currBranchFile.maxPercentIncrease) &&
        diffPercent > currBranchFile.maxPercentIncrease) {
        failReasons.push(FailReason.MaxPercentIncrease);
    }
    if (failReasons.length === 0) {
        return { status: Status.Pass };
    }
    return { status: Status.Fail, failReasons };
}
